# Copyright (c) 2026 Joseph Verdicchio and EvidenceOS Contributors
# SPDX-License-Identifier: Apache-2.0

services:
  evidenceos:
    build:
      context: .
      dockerfile: Dockerfile
    image: evidenceos:local
    ports:
      - "50051:50051"
      - "8081:8081"
      - "9464:9464"
    environment:
      EVIDENCEOS_KEY_PROVIDER: "file"
      EVIDENCEOS_HMAC_KEYS: "default:6368616e67652d6d652d64656661756c742d736563726574,rotate-2026q2:6368616e67652d6d652d726f74617465642d736563726574"
    volumes:
      - ./ops/data:/data
      - ./ops/certs:/certs:ro
      - ./ops/keys:/data/keys:rw
      - ./ops/oracles:/oracles:ro
    command:
      [
        "--listen",
        "0.0.0.0:50051",
        "--data-dir",
        "/data",
        "--oracle-dir",
        "/oracles",
        "--tls-cert",
        "/certs/server.crt",
        "--tls-key",
        "/certs/server.key",
        "--mtls-client-ca",
        "/certs/ca.crt",
        "--require-client-cert",
        "--preflight-http-listen",
        "0.0.0.0:8081",
        "--preflight-require-bearer-token",
        "change-me-preflight-token"
      ]
